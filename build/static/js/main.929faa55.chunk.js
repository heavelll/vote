(this["webpackJsonpvote-frontend"]=this["webpackJsonpvote-frontend"]||[]).push([[0],{135:function(e,t,a){e.exports=a(209)},140:function(e,t,a){},141:function(e,t,a){},185:function(e,t,a){},209:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(9),c=a.n(r),o=(a(140),a(18)),s=a.n(o),i=a(38),u=a(10),m=(a(141),a(8)),d=(a(142),a(23)),p=a.n(d),v=a(21),E=a(60),f=a(219),h=a(220);function g(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"create"},l.a.createElement(f.a,{className:"createicon"}),l.a.createElement("div",null,l.a.createElement(E.a,{size:"large",style:{width:"70%"},type:"primary"},l.a.createElement(v.b,{to:"/create-vote"},"\u521b\u5efa\u5355\u9009")))),l.a.createElement("div",{className:"create"},l.a.createElement(h.a,{className:"createicon"}),l.a.createElement("div",null,l.a.createElement(E.a,{size:"large",style:{width:"70%"},type:"primary"},l.a.createElement(v.b,{to:"/create-vote?multiple=1"},"\u521b\u5efa\u591a\u9009")))))}function b(e){var t=e.setUserInfo,a=Object(n.useState)(null),r=Object(u.a)(a,2),c=r[0],o=r[1],s=Object(m.g)();return Object(n.useEffect)((function(){p.a.get("/my").then((function(e){o(e.data)}))}),[]),l.a.createElement(l.a.Fragment,null,l.a.createElement("ul",null,c?c.votes.reverse().map((function(e){return l.a.createElement("li",{key:e.id,className:"voteList"},l.a.createElement("div",null,l.a.createElement(v.b,{to:"/vote/".concat(e.id)},e.title)))})):l.a.createElement("li",null,"loading...")),l.a.createElement("div",null,l.a.createElement(E.a,{type:"primary",danger:!0,onClick:function(){p.a.get("/logout").then((function(){s.push("/login"),t(null)}))}},"\u767b\u51fa")))}var y=a(221),O=a(222);function N(e){var t=e.setUserInfo,a=Object(m.j)(),n=(a.path,a.url);return l.a.createElement(l.a.Fragment,null,l.a.createElement(m.b,{path:"".concat(n,"/"),exact:!0},l.a.createElement(m.a,{to:"".concat(n,"/create")})),l.a.createElement(m.b,{path:"".concat(n,"/create")},l.a.createElement("header",null,"\u521b\u5efa\u6295\u7968"),l.a.createElement("content",null,l.a.createElement(g,null))),l.a.createElement(m.b,{path:"".concat(n,"/my")},l.a.createElement("header",null,"\u6211\u7684\u6295\u7968"),l.a.createElement("content",null,l.a.createElement(b,{setUserInfo:t}))),l.a.createElement("footer",null,l.a.createElement(v.c,{to:"".concat(n,"/create"),className:"nav",activeClassName:"selected"},l.a.createElement("div",null,l.a.createElement(y.a,{className:"navicon"})),l.a.createElement("div",null,"\u521b\u5efa")),l.a.createElement(v.c,{to:"".concat(n,"/my"),className:"nav",activeClassName:"selected"},l.a.createElement("div",null,l.a.createElement(O.a,{className:"navicon"})),l.a.createElement("div",null,"\u6211\u7684"))))}var w=a(213),j=a(223);function k(e){var t=e.setUserInfo,a=Object(m.g)(),r=Object(n.useRef)(),c=Object(n.useRef)();function o(){return(o=Object(i.a)(s.a.mark((function e(n){var l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,p.a.post("/login",{name:r.current.state.value,password:c.current.state.value});case 4:l=e.sent,t(l.data),a.push("/home"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),alert(e.t0.response.data.msg.toString());case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}return l.a.createElement("div",null,l.a.createElement("header",null,"\u767b\u5f55"),l.a.createElement("div",{className:"inputzone"},l.a.createElement("div",null,l.a.createElement(w.a,{placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",className:"login",prefix:l.a.createElement(O.a,null),ref:r})),l.a.createElement("br",null),l.a.createElement("div",null,l.a.createElement(w.a.Password,{className:"login",prefix:l.a.createElement(j.a,null),placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",ref:c})),l.a.createElement("br",null),l.a.createElement(E.a,{size:"large",style:{width:"70%"},type:"primary",onClick:function(e){return o.apply(this,arguments)}},"\u767b\u5f55")),l.a.createElement("div",{className:"regInLog"},l.a.createElement(v.b,{to:"/register"},"\u6ce8\u518c\u5e10\u53f7")))}var x=a(49),I=a(216),C=a(211),S=a(217),L=a(48),U=a.n(L),B=(a(105),a(218)),F=a(224),D=a(225),R=a(226);function z(){var e=new URLSearchParams(Object(m.h)().search),t=Object(m.g)(),a=Object(I.a)(["",""]),n=Object(C.a)(),r=Object(C.a)(),c=Object(C.a)(),o=Object(S.a)(),u=Object(S.a)(1==e.get("multiple"));function d(){return(d=Object(i.a)(s.a.mark((function e(l){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.preventDefault(),e.prev=1,n.value&&a.value&&c.value){e.next=5;break}return alert("\u8bf7\u586b\u5199\u5fc5\u586b\u9879"),e.abrupt("return");case 5:return e.next=7,p.a.post("/vote",{title:n.value,desc:r.value,options:a.value,deadLine:U()(c.value).toISOString(),anonymous:o.value?1:0,isMultiple:u.value?1:0});case 7:alert("\u521b\u5efa\u6210\u529f"),t.push("/home/my"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),alert("\u521b\u5efa\u5931\u8d25");case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}return l.a.createElement("div",null,l.a.createElement("header",null,l.a.createElement("span",{className:"back",onClick:function(){window.history.go(-1)}},l.a.createElement(F.a,null)),u.value?"\u521b\u5efa\u591a\u9009\u6295\u7968":"\u521b\u5efa\u5355\u9009\u6295\u7968"),l.a.createElement("div",{className:"voteUpOuter"},l.a.createElement("div",{className:"voteUpInner"},l.a.createElement("div",null,l.a.createElement("input",{type:"text",className:"voteTitle voteInput",value:n.value,onChange:n.onChange,placeholder:"\u6295\u7968\u6807\u9898"})),l.a.createElement("div",null,l.a.createElement("input",{type:"text",className:"voteDesc voteInput",value:r.value,onChange:r.onChange,placeholder:"\u63cf\u8ff0\u5185\u5bb9(\u9009\u586b)"})),l.a.createElement("ul",null,a.value.map((function(e,t){return l.a.createElement("div",{key:t,className:"optBox"},l.a.createElement(D.a,{onClick:function(){return function(e){a.value.length>2&&a.removeIndex(e)}(t)},className:"dltadd dltBtn",style:{color:"red"}}),l.a.createElement("input",{className:"voteOpt voteInput",type:"text",placeholder:"\u9009\u9879",value:e,onChange:function(e){a.setValue([].concat(Object(x.a)(a.value.slice(0,t)),[e.target.value],Object(x.a)(a.value.slice(t+1))))}}))}))),l.a.createElement("div",{className:"addOpt",onClick:function(){a.push("")}},l.a.createElement(R.a,{style:{color:"#1890FF"},className:"dltadd"})))),l.a.createElement("div",{className:"checkPart"},l.a.createElement("div",{className:"checkInnerPart"},l.a.createElement("div",{className:"checkBox"},l.a.createElement("span",null,"\u622a\u6b62\u65e5\u671f"),l.a.createElement("div",{className:"checkInput"},l.a.createElement("input",{type:"datetime-local",className:"deadLine",value:c.value,onChange:c.onChange}))),l.a.createElement("div",{className:"checkBox"},l.a.createElement("span",null,"\u533f\u540d\u6295\u7968"),l.a.createElement("div",{className:"checkInput"},l.a.createElement(B.a,{checked:o.value,onChange:o.toggle}))),l.a.createElement("div",{className:"checkBox"},l.a.createElement("span",null,"\u591a\u9009"),l.a.createElement("div",{className:"checkInput"},l.a.createElement(B.a,{checked:u.value,onChange:u.toggle}))),l.a.createElement("div",{className:"sendCreate"},l.a.createElement(E.a,{style:{width:"70%"},type:"primary",size:"large",onClick:function(e){return d.apply(this,arguments)}},"\u521b\u5efa")))))}a(185);var P=a(58),V=a.n(P);function A(e){var t=e.userInfo,a=Object(m.i)().id,r=Object(n.useState)(!0),c=Object(u.a)(r,2),o=c[0],d=c[1],v=Object(n.useState)(null),E=Object(u.a)(v,2),f=E[0],h=E[1],g=Object(n.useState)(null),b=Object(u.a)(g,2),y=b[0],O=b[1];if(!o)var N=Object(P.groupBy)(y,"optionId"),w=Object(P.uniqBy)(y,"userId").length;function j(){return(j=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!U()(f.deadLine).isBefore((new Date).toISOString())){e.next=3;break}return alert("\u8be5\u6295\u7968\u5df2\u8fc7\u671f\uff0c\u4e0d\u80fd\u518d\u8fdb\u884c\u6295\u7968"),e.abrupt("return");case 3:return e.next=5,p.a.post("/voteup/".concat(a),{optionId:t,isVoteDown:n}).then((function(e){}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){h(null),d(!0),p.a.get("/vote/".concat(a)).then((function(e){h(e.data.data),O(e.data.data.votings),d(!1)}))}),[a]),Object(n.useEffect)((function(){if(f&&U()(f.deadLine).isAfter((new Date).toISOString())){var e=new WebSocket("wss://".concat(window.location.host,"/vote/").concat(a));return e.onmessage=function(e){O(JSON.parse(e.data))},function(){return e.close()}}}),[a,f]),o?l.a.createElement("div",null,"loading..."):l.a.createElement("div",{className:"viewVote"},l.a.createElement("header",null,l.a.createElement("span",{className:"back",onClick:function(){window.history.go(-1)}},l.a.createElement(F.a,null)),"\u8fdb\u884c\u6295\u7968"),l.a.createElement("div",{className:"voteHead"},l.a.createElement("h2",null,f.title),l.a.createElement("p",null,f.desc," ",l.a.createElement("span",null,f.isMultiple?"[\u591a\u9009]":"[\u5355\u9009]"))),l.a.createElement("ul",null,f.options.map((function(e){var a=N[e.id]||[];if(t)var n=!!a.find((function(e){return e.userId===t.user.id}));return l.a.createElement("li",{key:e.id},l.a.createElement("div",{className:"innerVote"},t?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"outerVote",onClick:function(){return function(e,t){return j.apply(this,arguments)}(e.id,n)}},l.a.createElement("div",{className:"voteLine"},n&&l.a.createElement("span",{className:"checkIdt"}),l.a.createElement("input",{type:"checkbox",checked:n,onChange:function(){}}),l.a.createElement("span",{className:"voteContent"},e.content),l.a.createElement("span",{className:"statistic"},a.length,"\u7968 ",J(a.length,w),"%"))),l.a.createElement("div",{className:"option-ratio",style:{width:J(a.length,w)+"%"}}),l.a.createElement("div",{className:"avatarZone"},a.map((function(e,t){return l.a.createElement("img",{src:e.avatar,key:t,className:"avatar"})})))):l.a.createElement("div",null,"loading...")))}))),U()(f.deadLine).isBefore((new Date).toISOString())&&l.a.createElement("div",{className:"deadLine"},"(\u5df2\u8fc7\u671f)"),l.a.createElement("span",{className:"deadLine"},"\u6295\u7968\u622a\u6b62\u81f3: ",U()(f.deadLine).format("LLLL")))}function J(e,t){return 0===t?0:(e/t*100).toFixed()}var M=a(113),T=a(114),W=a(134),G=a(130),K=a(214),q=a(212),H=a(227),Y=a(228),Z=a(229);function $(){var e=Object(m.g)(),t=Object(n.useRef)(),a=Object(n.useRef)(),r=Object(n.useRef)(),c=Object(n.useRef)(),o=Object(n.useState)(),d=Object(u.a)(o,2),f=d[0],h=d[1],g=Object(n.useState)(),b=Object(u.a)(g,2),y=b[0],N=b[1],k={};function x(){return(x=Object(i.a)(s.a.mark((function n(){var l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(f&&r.current.state.value&&y&&!f.code&&!y.code){n.next=3;break}return alert("\u6ce8\u518c\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u586b\u5199"),n.abrupt("return");case 3:return(l=new FormData).append("name",t.current.state.value),l.append("password",r.current.state.value),l.append("email",a.current.state.value),l.append("avatar",k.file),n.next=10,p.a.post("register",l).then((function(t){alert(t.data.msg),e.push("/login")})).catch((function(e){alert(e)}));case 10:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function I(){return(I=Object(i.a)(s.a.mark((function e(a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/conflict/name",{name:t.current.state.value}).then((function(e){h(e.data)})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/conflict/email",{email:a.current.state.value}).then((function(e){N(e.data)})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=V.a.debounce((function(e){return I.apply(this,arguments)}),1e3),L=V.a.debounce((function(e){return C.apply(this,arguments)}),1e3);function U(e,t){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.readAsDataURL(e)}function B(e){var t="image/jpeg"===e.type||"image/png"===e.type;t||K.b.error("You can only upload JPG/PNG file!");var a=e.size/1024/1024<2;return a||K.b.error("Image must smaller than 2MB!"),k.file=e,t&&a}var F=function(e){Object(W.a)(a,e);var t=Object(G.a)(a);function a(){var e;Object(M.a)(this,a);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(e=t.call.apply(t,[this].concat(l))).state={loading:!1},e.handleChange=function(t){"uploading"!==t.file.status?"done"===t.file.status&&U(t.file.originFileObj,(function(t){return e.setState({imageUrl:t,loading:!1})})):e.setState({loading:!0})},e}return Object(T.a)(a,[{key:"render",value:function(){var e=this.state,t=e.loading,a=e.imageUrl,n=l.a.createElement("div",null,t?l.a.createElement(H.a,null):l.a.createElement(Y.a,null),l.a.createElement("div",{style:{marginTop:8}},"Upload"));return l.a.createElement(q.a,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",beforeUpload:B,onChange:this.handleChange},a?l.a.createElement("img",{src:a,alt:"avatar",style:{width:"100%"}}):n)}}]),a}(l.a.Component);return l.a.createElement("div",null,l.a.createElement("header",null,"\u6ce8\u518c"),l.a.createElement("div",{className:"inputzone"},l.a.createElement("div",null,l.a.createElement(w.a,{placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",onKeyUp:S,className:"login",prefix:l.a.createElement(O.a,null),ref:t})),f?l.a.createElement("span",{className:f.code?"con":"notCon"},f.msg):l.a.createElement("br",null),l.a.createElement("div",null,l.a.createElement(w.a.Password,{className:"login",prefix:l.a.createElement(j.a,null),placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",ref:r})),l.a.createElement("br",null),l.a.createElement("div",null,l.a.createElement(w.a,{placeholder:"\u8bf7\u8f93\u5165\u90ae\u7bb1",onKeyUp:L,className:"login",prefix:l.a.createElement(Z.a,null),ref:a})),y?l.a.createElement("span",{className:y.code?"con":"notCon"},y.msg):l.a.createElement("br",null),l.a.createElement("div",null,"\u4e0a\u4f20\u5934\u50cf:",l.a.createElement(F,{ref:c}),l.a.createElement("br",null)),l.a.createElement(E.a,{size:"large",style:{width:"70%"},type:"primary",onClick:function(){return x.apply(this,arguments)}},"\u6ce8\u518c")),l.a.createElement("div",{className:"regInLog"},l.a.createElement(v.b,{to:"/login"},"\u53bb\u767b\u9646")))}var Q=l.a.useEffect;var X=function(){var e=Object(m.g)(),t=Object(n.useState)(null),a=Object(u.a)(t,2),r=a[0],c=a[1];return Q((function(){Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.get("/userInfo").then((function(e){c(e.data)})).catch((function(t){console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u5c06\u663e\u793a\u767b\u5f55\u754c\u9762"),"#/register"===window.location.hash?e.push("/register"):e.push("/login")}));case 2:case"end":return t.stop()}}),t)})))()}),[]),l.a.createElement("div",{className:"App"},l.a.createElement(m.d,null,l.a.createElement(m.b,{path:"/register"},l.a.createElement($,null)),l.a.createElement(m.b,{path:"/",exact:!0},l.a.createElement(m.a,{to:"/home"})),l.a.createElement(m.b,{path:"/home"},r?l.a.createElement(N,{setUserInfo:c}):l.a.createElement(k,{setUserInfo:c})),l.a.createElement(m.b,{path:"/login"},l.a.createElement(k,{setUserInfo:c})),l.a.createElement(m.b,{path:"/create-vote"},l.a.createElement(z,null)),l.a.createElement(m.b,{path:"/vote/:id"},l.a.createElement(A,{userInfo:r}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(l.a.createElement(v.a,null,l.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[135,1,2]]]);
//# sourceMappingURL=main.929faa55.chunk.js.map
